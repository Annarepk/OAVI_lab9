# OAVI_lab9
_Анализ шума в аудиосигналах_


Была поставлена следующая задача:

1. Записать звук музыкального инструмента (формат WAV)
2. Построить спектрограмму с оконным преобразованием Фурье (окно Ханна)
3. Оценить уровень шума и применить фильтрацию (Савицкого-Голея и Винеровский фильтр)
4. Найти моменты времени с наибольшей энергией в заданных частотных диапазонах

***

## Функции

Основные функции находятся в файле `noise.py`.

### noise.py

- `highEnergyWindows(samples: np.ndarray, sampleRate: int, windowDuration: float = 0.1) -> tuple`
    > Находит временные окна с максимальной энергией сигнала
    >
    > _ПАРАМЕТРЫ:_  
    >    * **samples** - Аудиоданные (массив numpy)  
    >    * **sampleRate** - Частота дискретизации  
    >    * **windowDuration** - Длительность анализируемого окна (по умолчанию 0.1 сек)  
    >
    > _ВОЗВРАЩАЕТ:_  
    >    * Кортеж (maxTime, times, energyTotal) - время максимума, массив времен, массив энергий

- `spectrogram(samples: np.ndarray, sampleRate: int, t: int = 10000) -> None`
    > Строит спектрограмму сигнала
    >
    > _ПАРАМЕТРЫ:_  
    >    * **samples** - Аудиоданные  
    >    * **sampleRate** - Частота дискретизации  
    >    * **t** - Верхняя граница частот для отображения  

- `denoise(samples: np.ndarray, sampleRate: int, cutoffFreuency: int, passes: int = 1) -> np.ndarray`
    > Применяет комбинированную фильтрацию (Савицкого-Голея + БИХ-фильтр)
    >
    > _ПАРАМЕТРЫ:_  
    >    * **samples** - Аудиоданные  
    >    * **sampleRate** - Частота дискретизации  
    >    * **cutoffFreuency** - Граничная частота фильтра  
    >    * **passes** - Количество проходов фильтра  
    >
    > _ВОЗВРАЩАЕТ:_  
    >    * Отфильтрованный сигнал

- `PCM(y: np.ndarray) -> np.ndarray`
    > Конвертирует нормализованный сигнал в PCM-формат
    >
    > _ПАРАМЕТРЫ:_  
    >    * **y** - Нормализованный сигнал (диапазон [-1, 1])  
    >
    > _ВОЗВРАЩАЕТ:_  
    >    * Сигнал в 16-битном PCM формате

---

# Работа программы

## Исходный сигнал

### Оригинальная спектрограмма:
<img src="audio/spectrogram.png" width="500">

_Полный частотный диапазон до 20 кГц_

## Фильтрация шума

### После однократной фильтрации:
<table>
  <tr>
    <td><img src="audio/denoised_spectrogram_once.png" width="400"></td>
    <td><img src="audio/denoised_spectrogram_savgol.png" width="400"></td>
  </tr>
  <tr>
    <td>Комбинированная фильтрация</td>
    <td>Только фильтр Савицкого-Голея</td>
  </tr>
</table>

### После двукратной фильтрации:
<img src="audio/denoised_spectrogram_twice.png" width="500">

## Анализ энергии сигнала

### Распределение энергии по времени:
<img src="audio/energy_peaks.png" width="500">

_Пики отмечены вертикальными линиями_

## Сравнение аудиофайлов
- [Исходный файл](audio/music.wav)
- [После однократной фильтрации](audio/denoised_once.wav)
- [После двукратной фильтрации](audio/denoised_twice.wav)

***

### Технические детали
- Частота дискретизации: 44.1 кГц
- Использованное окно для Фурье-анализа: Ханна
- Параметры фильтрации:
  - Пороговая частота: 1000 Гц
  - Порядок фильтра: 3
  - Длина окна Савицкого-Голея: 100 отсчетов